<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="apple-touch-icon" sizes="76x76" href="_content/Hurudza.UI.Shared/img/apple-icon.png">
    <link rel="icon" type="image/png" href="_content/Hurudza.UI.Shared/img/favicon.png">
    <title>Hurudza</title>
    <base href="/" />
    <!--     Fonts and icons     -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet" />
    <!-- Nucleo Icons -->
    <link href="_content/Hurudza.UI.Shared/css/nucleo-icons.css" rel="stylesheet" />
    <link href="_content/Hurudza.UI.Shared/css/nucleo-svg.css" rel="stylesheet" />
    <!-- Font Awesome Icons -->
    <script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script>
    <link href="_content/Hurudza.UI.Shared/css/nucleo-svg.css" rel="stylesheet" />
    <!-- CSS Files -->
    <link id="pagestyle" href="_content/Hurudza.UI.Shared/css/soft-ui-dashboard.css?v=1.0.10" rel="stylesheet" />
    <link href="_content/Hurudza.UI.Shared/css/app.css" rel="stylesheet" />
    <link rel="icon" type="image/png" href="favicon.png" />
    <link href="Hurudza.UI.Web.styles.css" rel="stylesheet" />
    <link href="_content/Syncfusion.Blazor.Themes/bootstrap5.css" rel="stylesheet" />
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.css' rel='stylesheet' />
</head>

<body class="g-sidenav-show bg-gray-100" id="body">
<div id="app">
    <svg class="loading-progress">
        <circle r="40%" cx="50%" cy="50%" />
        <circle r="40%" cx="50%" cy="50%" />
    </svg>
    <div class="loading-progress-text"></div>
</div>

<div id="blazor-error-ui">
    An unhandled error has occurred.
    <a href="" class="reload">Reload</a>
    <a class="dismiss">ðŸ—™</a>
</div>
<script src="_content/Microsoft.AspNetCore.Components.WebAssembly.Authentication/AuthenticationService.js"></script>
<script src="_content/Syncfusion.Blazor.Core/scripts/syncfusion-blazor.min.js" type="text/javascript"></script>
<script src="_framework/blazor.webassembly.js"></script>

<!--   Core JS Files   -->
<script src="_content/Hurudza.UI.Shared/js/core/popper.min.js"></script>
<script src="_content/Hurudza.UI.Shared/js/core/bootstrap.min.js"></script>
<script src="_content/Hurudza.UI.Shared/js/plugins/perfect-scrollbar.min.js"></script>
<script src="_content/Hurudza.UI.Shared/js/plugins/smooth-scrollbar.min.js"></script>
<script>
    var win = navigator.platform.indexOf('Win') > -1;
    if (win && document.querySelector('#sidenav-scrollbar')) {
        var options = {
            damping: '0.5'
        }
        Scrollbar.init(document.querySelector('#sidenav-scrollbar'), options);
    }

    if (win && document.querySelector('#farm-scrollbar')) {
        var options = {
            damping: '0.5'
        }
        Scrollbar.init(document.querySelector('#farm-scrollbar'), options);
    }
</script>
<!-- Control Center for Soft Dashboard: parallax effects, scripts for the example pages etc -->
<script src="_content/Hurudza.UI.Shared/js/soft-ui-dashboard.min.js?v=1.0.7"></script>
<script src='https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.js'></script>
<script>
    function loadMap(farm) {
        console.log(farm);
        mapboxgl.accessToken = 'pk.eyJ1IjoicGVuaWVsdCIsImEiOiJjbGt3Y2gxM3YweWtrM3FwbW9jaWNkMWVyIn0.cDAgTWNXN-TVJROjgoWQiw';
        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/satellite-v9',
            center: [32.2247662278443, -18.767832680211384],
            zoom: 14
        });

        map.on('load', () => {
            // Add a data source containing GeoJSON data.
            map.addSource('maine', {
                'type': 'geojson',
                'data': {
                    'type': 'Feature',
                    'geometry': {
                        'type': 'Polygon',
                        'coordinates': farm.farmPolygon
                    }
                }
            });

            // Add a black outline around the polygon
            map.addLayer({
                'id': 'outline',
                'type': 'line',
                'source': 'maine',
                'layout': {},
                'paint': {
                    'line-color': '#000',
                    'line-width': 3
                }
            });

            // Iterate over all fields and add them to the map
            for (const field of farm.fields) {
                map.addSource(field.id, {
                    'type': 'geojson',
                    'data': {
                        'type': 'Feature',
                        'geometry': {
                            'type': 'Polygon',
                            'coordinates': field.coordinates
                        }
                    }
                });

                // Add a new Layer to visualize the polygon
                map.addLayer({
                    'id': field.id,
                    'type': 'fill',
                    'source': field.id, // reference the data source
                    'layout': {},
                    'paint': {
                        'fill-color': '#0080ff',
                        'fill-opacity': 0.1
                    }
                });

                // Add a black outline around the polygon
                map.addLayer({
                    'id': 'outline' + field.id,
                    'type': 'line',
                    'source': field.id,
                    'layout': {},
                    'paint': {
                        'line-color': '#ff0000',
                        'line-width': 1
                    }
                });

                // When a click event occurs on a feature in the fields layer,
                // open a popup at the location of the click, with description
                // HTML from the click event's  properties.
                map.on('click', field.id, (e) => {
                    new mapboxgl.Popup()
                        .setLngLat(e.lngLat)
                        .setHTML(field.name)
                        .addTo(map);
                });

                // Change the cursor to a pointer when
                // the mouse is over the field layer.
                map.on('mouseenter', field.id, () => {
                    map.getCanvas().style.cursor = 'pointer';
                });

                map.on('mouseleave', field.id, () => {
                    map.getCanvas().style.cursor = '';
                });
            }
        });
    }
</script>
    <script>
        const element = document.getElementById("body");
        element.classList.add("g-sidenav-hidden");
    </script>
</body>

</html>
